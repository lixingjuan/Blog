<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/Blog/favicon.png" />
    

    <title>
        
          脚本参数化的思考 - 李幸娟的前端博客
        
    </title>

    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/Blog/css/book.css">

    
<script src="/Blog/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

<meta name="generator" content="Hexo 4.2.0"></head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/Blog/">
    <img src="/Blog/favicon.png">
    <span>李幸娟的前端博客</span>
  </a>
</div>
    <div class="book-menu">
  <!--
 * @version: 0.0.1
 * @Author: lixingjuan <xingjuan.li@hand-china.com>
 * @Date: 2020-02-28 10:57:23
 * @copyright: Copyright (c) 2019, Hand
 -->
<!-- * [Home](/[hexo-theme-book-demo](http://localhost:4000/Blog/)) -->
<ul>
<li><a href="/Blog/">Home</a></li>
<li><a href="/hexo-theme-book-demo/changelog">Changelog</a></li>
</ul>
<h1 style="color:#448d55;">一级菜单1</h1>
<h2 id="二级菜单1">二级菜单1</h2>
<ul>
<li><a href="/demo1/%E4%BA%8C%E7%BA%A7%E8%8F%9C%E5%8D%951/test1">测试文章1</a></li>
<li><a href="/demo1/%E4%BA%8C%E7%BA%A7%E8%8F%9C%E5%8D%951/test2">测试文章1</a></li>
</ul>
<h2 id="二级菜单2">二级菜单2</h2>
<ul>
<li><a href="/demo1/%E4%BA%8C%E7%BA%A7%E8%8F%9C%E5%8D%951/test1">测试文章1</a></li>
<li><a href="/demo1/%E4%BA%8C%E7%BA%A7%E8%8F%9C%E5%8D%951/test2">测试文章1</a></li>
</ul>
<h2 id="二级菜单3">二级菜单3</h2>
<ul>
<li><a href="/demo1/%E4%BA%8C%E7%BA%A7%E8%8F%9C%E5%8D%951/test1">测试文章1</a></li>
<li><a href="/demo1/%E4%BA%8C%E7%BA%A7%E8%8F%9C%E5%8D%951/test2">测试文章1</a></li>
</ul>
<h1 style="color:#448d55;">一级菜单2</h1>
<h2 id="二级菜单1-v2">二级菜单1</h2>
<h2 id="二级菜单2-v2">二级菜单2</h2>
<h2 id="二级菜单3-v2">二级菜单3</h2>
<ul>
<li><a href="/hexo-theme-book-demo/test/hexo-unit-test/categories">Categories</a></li>
</ul>

</div>


<script src="/Blog/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <h2 id="作用域">作用域</h2>
<ul>
<li>区分LHS 和 RHS</li>
</ul>
<blockquote>
<p>1.LHS -&gt; 左查询   -&gt; 为了赋值<br>
2.RHS -&gt; 非左查询 -&gt; 为了查到变量的值</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例1：</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例2：</span></span><br><span class="line">- RHS查询demo</span><br><span class="line">- LHS查询num，将<span class="number">2</span>赋值num</span><br><span class="line">- RHS查询num的值</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">demo</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(num)</span><br><span class="line">&#125;</span><br><span class="line">demo(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例3：</span></span><br><span class="line"><span class="built_in">console</span>.log(a)</span><br></pre></td></tr></table></figure>
<ul>
<li>LHS 和 RHS 异常报错</li>
</ul>
<blockquote>
<ul>
<li>若 RHS 查询在所有嵌套的作用域中遍寻不到所需的变量，引擎就会抛出 ReferenceError异常;</li>
<li>若引擎执行 LHS 查询时，在顶层（全局作用域）中也无法找到目标变量，“严格模式”下，全局作用域中就会创建一个具有该名称的变量，并将其返还给引擎；“严格模式下”，禁止自动或隐式地创建全局变量，LHS 查询失败时，并不会创建并返回一个全局变量，引擎会抛出ReferenceError异常;</li>
<li>若RHS 查询找到了一个变量，但是你尝试对这个变量的值进行不合理的操作，<br>
比如试图对一个非函数类型的值进行函数调用，或着引用 null 或 undefined 类型的值中的属性，那么引擎会抛出 TypeError;</li>
</ul>
</blockquote>
<h2 id="词法作用域">词法作用域</h2>
<blockquote>
<p>词法作用域：由定义变量或者函数声明的位置决定</p>
</blockquote>
<ul>
<li>举例</li>
</ul>
<ol>
<li>b的词法作用域即函数a()的局部作用域</li>
<li>变量a是全局变量 =&gt; 函数aFun，bFun，cFun均可以访问</li>
<li>变量c是局部变量 =&gt; 函数aFun，bFun可以访问</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aFun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> c</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bFun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> d</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cFun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>未声明即使用的变量是全局变量，注意任何位置均可访问的问题</li>
</ul>
<h2 id="函数作用域和块作用域">函数作用域和块作用域</h2>
<h3 id="var声明的变量都会成为全局变量">var声明的变量都会成为全局变量</h3>
<h3 id="let">let</h3>
<ul>
<li>let会为其声明的变量隐式绑定所在的块作用域，通常是{…}内部（eg.1）</li>
<li>开发时最好为块作用域显式地创建块, 使变量的附属关系变得更加清晰（eg.2）</li>
<li>块作用域非常有用的原因和闭包及回收内存垃圾的回收机制相关 (eg.3.1 3.2),
<ul>
<li>原本process执行之后process(…) 执行后，someReallyBigData变量占用的内存就可以销毁，</li>
<li>但是， click 函数形成了一个覆盖整个作用域的闭包，someReallyBigData变量虽然没有使用，JavaScript 引擎极有可能依然保存着这个结构（取决于具体实现），添加了块级作用域后，让引擎清楚地知道没有必要继续保存 someReallyBigDat变量；</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eg.1</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(i)  <span class="comment">// ReferenceError</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// eg.2</span></span><br><span class="line"><span class="keyword">if</span>(foo)&#123;</span><br><span class="line">  &#123; <span class="comment">// =&gt; 显式的块</span></span><br><span class="line">    <span class="keyword">let</span> bar = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(bar);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// eg.3.1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> someReallyBigData = &#123; .. &#125;;</span><br><span class="line">process( someReallyBigData );</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById( <span class="string">"my_button"</span> );</span><br><span class="line">btn.addEventListener( <span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> <span class="title">click</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"hello"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// eg.3.2</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 在这个块中定义的内容可以销毁了！</span></span><br><span class="line">  <span class="keyword">let</span> someReallyBigData = &#123; .. &#125;;</span><br><span class="line">  process( someReallyBigData );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById( <span class="string">"my_button"</span> );</span><br><span class="line">btn.addEventListener( <span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> <span class="title">click</span>(<span class="params">evt</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"hello"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="函数声明和函数表达式">函数声明和函数表达式</h3>
<blockquote>
<p>区分：看function 的位置 （function 是声明中的第一个词，那么就是一个函数声明 ）<br>
区别：名称标识符将会绑定在何处:</p>
<ol>
<li>a : 被绑定在全局作用域</li>
<li>b : 被绑定在函数表达式自身的函数中, 即 （…）所在的位置中访问，外部作用域则不行,b 变量名被隐藏在自身中意味着不会污染外部作用域</li>
</ol>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数表达式</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="块级作用域">块级作用域</h3>
<h3 id="立即执行函数表达式（IIFE）">立即执行函数表达式（IIFE）</h3>
<blockquote>
<p>由于函数被包括在一对（）括号内部，第一个()使之成为一个表达式，第二个()执行了这个函数</p>
</blockquote>
<blockquote>
<p>优点：</p>
<ol>
<li>不污染全局作用域</li>
<li>不需显式的通过函数名调用这个函数</li>
</ol>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 写法一：</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;)()</span><br><span class="line"><span class="comment">// 写法二：</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;())</span><br><span class="line"><span class="comment">// 函数表达式</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">3</span>;</span><br><span class="line">  <span class="built_in">console</span>.log( a ); <span class="comment">// 3</span></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="built_in">console</span>.log( a ); <span class="comment">// 2</span></span><br><span class="line">foo() <span class="comment">// 报错：Uncaught ReferenceError</span></span><br></pre></td></tr></table></figure>
<h3 id="IIFE进阶用法">IIFE进阶用法</h3>
<ul>
<li>将IIFE当作函数调用并传递参数进去(eg.1)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eg.1</span></span><br><span class="line"><span class="comment">// 实参：window</span></span><br><span class="line"><span class="comment">// 形参：global</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">IIFE</span>(<span class="params">global</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> a =<span class="number">3</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 3</span></span><br><span class="line"><span class="built_in">console</span>.log(global.a) <span class="comment">// 2</span></span><br><span class="line">&#125;)(<span class="built_in">window</span>)</span><br></pre></td></tr></table></figure>
<h2 id="什么是闭包？">什么是闭包？</h2>
<blockquote>
<p>当函数可以 <strong>记住并访问</strong> 其所在的 <strong>词法作用域</strong> ，使函数在他<strong>本身词法作用域以外执行</strong>，就产生了闭包;</p>
</blockquote>
<ol>
<li>内部函数 showA 在被执行之前就被返回， 函数 showA 在定义的词法作用域以外被调用；</li>
<li>由于函数 showA 占用了函数 result 的变量a, 导致函数a执行完毕后，函数result() 的内存空间不会被垃圾回收机制清除；</li>
<li>函数 showA 依然持有函数result()函数作用域的引用，这个引用就叫做闭包；</li>
<li>闭包使得函数可以继续访问定义时的词法作用域；</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eg.1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">result</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showA</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> showA</span><br><span class="line">&#125;</span><br><span class="line">result()()  <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<h2 id="闭包应用场景举例">闭包应用场景举例</h2>
<blockquote>
<p>无论以何种方式对函数类型的值进行传递，在函数在别处调用时都可以观察到闭包</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以是在全局作用域调用局部函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cc = <span class="number">1</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(cc);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> fn = a()</span><br><span class="line">fn()  <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以是局部作用域调用另一个局部作用域的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cc = <span class="number">1</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(cc)</span><br><span class="line">  &#125;</span><br><span class="line">  b(c)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  fn()</span><br><span class="line">&#125;</span><br><span class="line">a()</span><br></pre></td></tr></table></figure>
<h2 id="开发中常见闭包应用场景举例">开发中常见闭包应用场景举例</h2>
<h3 id="1-setTimeout">1. setTimeout()</h3>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wait</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">  setTimeout( <span class="function"><span class="keyword">function</span> <span class="title">timer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log( message );</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">wait( <span class="string">"Hello,hello!"</span> );</span><br></pre></td></tr></table></figure>
<blockquote>
<p>1.timer 还持有变量message的引用 ，因此形成涵盖wait()函数作用域的闭包；<br>
2.wait() 执行1s后，他的内部作用域并不会消失，timer函数依然保有wait()作用域的闭包</p>
</blockquote>
<h3 id="2-for循环和setTimeout拿到正确的值问题">2. for循环和setTimeout拿到正确的值问题</h3>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i)<span class="comment">//10个10</span></span><br><span class="line">    &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>预想：每秒一次，每次一个，打印出1–10<br>
实际：1秒后一次打印出10个10</p>
</blockquote>
<h4 id="出现原因">出现原因</h4>
<ul>
<li>setTimeout的参数一直持有变量i,形成了闭包，</li>
<li>var 声明的i是全局变量</li>
<li>每次for循环就是将定时器（微任务）加入微任务队列，for循环之后依次执行微任务队列中的任务，而此时的i==10;</li>
<li>任务队列的十个setTimeout 共享同一个词法作用域，由于循环在定时任务触发之前就已经执行完毕，由于var声明变量具有变量提升的特点，此时的i===10,因此每次取出的的setTimeout任务访问到的i的值都是10</li>
</ul>
<blockquote>
<p>？setTimeout是1s后将任务加入任务队列还是立即加入任务队列，去队列中拿出来任务，等1s 再执行？</p>
</blockquote>
<h4 id="解决方法-使用let">解决方法:使用let</h4>
<blockquote>
<p>let会产生局部作用域<br>
let 不仅将 i 绑定到了 for 循环的块中，事实上循环的每一个迭代它将重新绑定，确保使用上一个循环迭代结束时的值重新进行赋值</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i)<span class="comment">//10个10</span></span><br><span class="line">    &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上边的代码执行顺序相当于</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a)</span><br><span class="line">a = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a)</span><br><span class="line"> a = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a)</span><br></pre></td></tr></table></figure>
<h3 id="3-闭包和for循环问题-同二">3. 闭包和for循环问题(同二)</h3>
<blockquote>
<p>闭包只能取得包含函数中任何变量的最后一个值</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>()</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    arr[i] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> i</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a()[<span class="number">0</span>]())   <span class="comment">// 10</span></span><br><span class="line"><span class="built_in">console</span>.log(a()[<span class="number">1</span>]())   <span class="comment">// 10</span></span><br><span class="line"><span class="built_in">console</span>.log(a()[<span class="number">2</span>]())   <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>
<h3 id="4-使用闭包模拟私有方法和变量">4. 使用闭包模拟私有方法和变量</h3>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意与单例模式进行区分</span></span><br><span class="line"><span class="comment">// 区分：todo:闭包各自维护自己的内存空间</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    add1: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      a += <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">return</span> a;</span><br><span class="line">    &#125;,</span><br><span class="line">    sub1: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      a -= <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">return</span> a;</span><br><span class="line">    &#125;,</span><br><span class="line">    aValue: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Demo1 = demo()</span><br><span class="line"><span class="keyword">var</span> Demo2 = demo()</span><br><span class="line"><span class="built_in">console</span>.log(Demo1.add1()) <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">console</span>.log(Demo2.add1()) <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>模拟了面向对象编程的样子，实现数据隐藏和封装<br>
Demo1 和Demo2  各自维护独立的各自独立的词法作用域，同时引用的是自己词法作用域的变量a<br>
每次调用 demo 的时候，通过改变这个变量的值，会改变这个闭包的词法作用域，然而在一个闭包内对变量的修改，并不会影响到另一个闭包中的变量</p>
</blockquote>
<h3 id="5-使用闭包设置单例模式">5. 使用闭包设置单例模式</h3>
<h4 id="什么是单例模式？">什么是单例模式？</h4>
<ul>
<li>保证一个类只有一个实例</li>
</ul>
<blockquote>
<p>常见的单例模式应用场景：</p>
<ol>
<li>windows的task manger(任务管理器)(非JS)</li>
<li>网站的计数器，一般也是采用单例模式实现，否则难以同步</li>
</ol>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// todo :单例模式仅实例化一次</span></span><br><span class="line"><span class="keyword">var</span> demo = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    add1: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      a += <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">return</span> a;</span><br><span class="line">    &#125;,</span><br><span class="line">    sub1: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      a -= <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">return</span> a;</span><br><span class="line">    &#125;,</span><br><span class="line">    aValue: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;())</span><br><span class="line"><span class="keyword">var</span> demo2 = demo</span><br><span class="line"><span class="built_in">console</span>.log(demo.add1())  <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">console</span>.log(demo2.add1()) <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<h3 id="6-内存泄漏问题">6. 内存泄漏问题</h3>
<h4 id="什么是内存泄漏？">什么是内存泄漏？</h4>
<ul>
<li>程序运行需要内存，只要程序提出需求，操作系统就必须提供内存，对于持续运行的服务进程，必须及时释放不再使用的内存，否则，内存占用越来越高， 轻则影响系统性能，重则导致进程崩溃；</li>
<li>不再用到的内存，没有及时释放，就叫做内存泄漏；</li>
</ul>
<h4 id="闭包会导致内存泄漏？">闭包会导致内存泄漏？</h4>
<ul>
<li>不会</li>
<li>由于IE9之前的版本对JScript对象和COM对象使用不同的垃圾收集，从而导致内存无法进行回收,所以可能导致内存泄漏；</li>
<li>由于闭包会使函数中的变量一直保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页的性能问题；</li>
</ul>
<h3 id="7-闭包实现数据问题，定时手动销毁">7. 闭包实现数据问题，定时手动销毁</h3>
<h3 id="8-函数防抖">8. 函数防抖</h3>
<h3 id="9-常见闭包中this的问题">9. 常见闭包中this的问题</h3>
<h3 id="10-闭包常见两个面试题">10. 闭包常见两个面试题</h3>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 题目1</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"The Window"</span>;</span><br><span class="line"><span class="keyword">var</span> object = &#123;</span><br><span class="line">　　name : <span class="string">"My Object"</span>,</span><br><span class="line">　　getNameFunc : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">　　　　<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">　　　　　　<span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">　　　　&#125;;</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">alert(object.getNameFunc()());  <span class="comment">// "The Window"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 题目2</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"The Window"</span>;</span><br><span class="line"><span class="keyword">var</span> object = &#123;</span><br><span class="line">　　name : <span class="string">"My Object"</span>,</span><br><span class="line">　　getNameFunc : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">　　　　<span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">　　　　<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">　　　　　　<span class="keyword">return</span> that.name;</span><br><span class="line">　　　　&#125;;</span><br><span class="line">　　&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">alert(object.getNameFunc()());  <span class="comment">// "My Object"</span></span><br></pre></td></tr></table></figure>
<h2 id="使用闭包注意">使用闭包注意</h2>
<h3 id="性能">性能</h3>
<ul>
<li>使用完成之后，记得手动清楚 赋值=null ，以免一直占用内存 （即内存泄漏问题）</li>
<li>闭包会携带包含他的函数作用域，因此会比其他函数占用更多的内存，过度使用可能会导致内存占用过多；</li>
</ul>
<h2 id="相关参考文章">相关参考文章</h2>
<ul>
<li>MDN：<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures</a></li>
<li>《你不知道的javascript(上)》</li>
<li>阮一峰：<a href="http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html</a></li>
</ul>

</div>


  <div class="book-comments">
    




  </div>



<script src="/Blog/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure
          class="avatar avatar-lg"
          data-initial="糯"
          style="background-color: #3b4351;">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>糯唧唧怪</div>
      <div>2019-01-01</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/Blog/categories/%E5%B7%A5%E4%BD%9C/">工作</a>

      <a class="tag-link" href="/Blog/tags/%E5%8F%82%E6%95%B0%E5%8C%96/" rel="tag">#参数化</a> <a class="tag-link" href="/Blog/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" rel="tag">#性能测试</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/Blog/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/Blog/js/book.js"></script>
